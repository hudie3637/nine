# 数据库功能启用指南

## 🚀 快速开始

### 1. 配置 Supabase
您已经在 `.env.local` 中配置了 Supabase URL，现在需要添加 anon key：

```bash
# 在 .env.local 文件中添加
SUPABASE_ANON_KEY="your_actual_anon_key_here"
```

### 2. 初始化数据库表
在 Supabase 控制台中执行 `supabase-init.sql` 脚本：

1. 登录 [Supabase 控制台](https://app.supabase.com/)
2. 选择您的项目
3. 进入 **SQL Editor**
4. 复制并粘贴 `supabase-init.sql` 的全部内容
5. 点击 **Run** 执行

### 3. 获取 Supabase anon key
1. 在 Supabase 控制台中进入 **Settings > API**
2. 找到 **Project API keys** 部分
3. 复制 **anon** public key
4. 粘贴到 `.env.local` 文件中的 `SUPABASE_ANON_KEY` 变量

## 🎯 新增功能

### 用户认证
- **登录/注册**：应用右上角添加了登录按钮
- **会话管理**：自动检测用户登录状态
- **用户资料**：自动创建和管理用户资料

### 云端存储
- **分析结果保存**：分析完成后可保存到云端
- **历史记录**：未来可查看历史分析记录
- **跨设备同步**：登录后可在不同设备间同步数据

## 📱 使用流程

1. **首次使用**：
   - 点击右上角"登录/注册"按钮
   - 输入邮箱和密码注册新账户
   - 系统会自动创建用户资料

2. **户型分析**：
   - 上传户型图进行分析
   - 分析完成后点击"保存到云端"按钮
   - 登录用户可享受云端存储功能

3. **用户管理**：
   - 右上角显示当前登录用户信息
   - 可随时点击"登出"退出账户

## 🔧 开发者说明

### 主要文件变更：
- `/lib/supabase.ts` - Supabase 客户端和操作函数
- `/src/App.tsx` - 添加了认证状态管理和 UI 元素
- `.env.local` - 添加了 Supabase 配置

### 可扩展功能：
- 用户个人中心页面
- 分析历史记录浏览
- 数据导出功能
- 团队协作功能

## ⚠️ 注意事项

1. **安全性**：RLS 策略已配置，用户只能访问自己的数据
2. **错误处理**：网络异常时会有友好提示
3. **离线使用**：未登录时仍可正常使用核心分析功能
4. **数据隐私**：所有用户数据都受到保护

## 🆘 故障排除

如果遇到问题：
1. 检查 `.env.local` 配置是否正确
2. 确认 Supabase 表结构已正确创建
3. 查看浏览器控制台是否有错误信息
4. 确保网络连接正常

---
现在您的建筑风水应用已经具备了完整的用户认证和云端存储功能！ 🎉